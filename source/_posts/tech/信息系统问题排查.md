title: 信息系统问题排查
date: 2016-04-27 23:40:29
categories: 技术
tags: [技术总结,java,问题分析]
toc: false
---
昨天查一个问题到比较晚，今天再回过头来总结的时候，发现自己再平时运维的时候缺少一些灵性，没有平时的积累，容易在关键时刻抓瞎，下面就来谈谈我总结的一个系统问题排查的思路。
<!--more-->
## 核心理念
在黄帝内经中有这样一段：
“是故圣人不治已病治未病，不治已乱治未乱，此之谓也。夫病已成而后药之，乱已成而后治之，譬犹渴而穿井，斗而铸锥，不亦晚乎？”
对于系统来说，也是一样的，防患于未然是系统开发的永恒主题，在开发完成之前解决的隐患，对个人，对公司来说，都是成本最小的。一旦真正爆发出来系统问题再去解决，很多时候并没有很好的方案去解决。所以，平时开发系统的时候，一定是合理第一，不要搞太多的临时方案，要记住，一个不好的临时方案就是一个定时炸弹，在系统出问题的时候就犹如饮鸩止渴。
当然，人是不可能不犯错的，所以总结一些处理问题的思路，总会对将来是有帮助的。

系统诊断和医生诊断是很类似的，如果有平时的对比，更容易看出问题。所以说，如果要在系统出问题的时候能及时处理，就要在系统不出问题的时候下点功夫，比如了解系统状态和业务状态。
## 系统现状
平时要养成记录的好习惯，对于系统正常状态下，线程数是多少、内存使用情况如何、网络流量是多少，磁盘IO怎样，CPU平均负载是多少。除此之外，还要了解，最近一段时间的峰值是多少。
要关注所有机器的现状，不能仅仅关注几套机器的情况，这样在出现问题的时候，你能知道，到底现在问题在哪里，是数据库拖挂了系统还是应用服务器挂了。
当异常状态出现的时候，你就知道，目前是CPU高，那就重点去看消耗CPU的进程（java core），如果是内存高，那就分析有可能出现大对象的地方，IO高，那日志级别是不是设置的不合理？
这样，从系统层面你可以给出一个诊断，目前是什么地方有问题，可能的问题代码在哪里，根据业务的一些日志，你可能就定位的差不多了。
## 业务现状
但是，定位不代表解决，要解决问题，一定脱离不开业务。当系统出现问题的时候，要解决问题未必能完全不影响线上运行的系统，这时候，如果要保证系统能正常提供服务，是需要进行一定的降级处理的，就是将一些我们认为不重要的业务，暂时忽略掉，保证核心业务的正常流转。
所谓的降级处理，说起来很高大上，其实就是在系统里面做一些开关，能够控制一些非核心的业务，当系统出现问题的时候，保障核心业务可以顺利进行。
所以你需要了解，PV/UV是多少，这些用户访问的时间偏好是什么，目前阶段系统最重要的业务是什么（比如招商的时候，销售就不是重点，销售的时候，招商就不是重点）？这样，你才能在一定要影响业务的时候给出一个最小影响的方案。
## 写在最后
善战者无赫赫之功，一个真正做系统好的人，是在谈方案的时候就处理好了这些问题，所以你能看到的是他完成了东西，但是看不到这个人预防了多少问题。一个解决自己系统问题的大师，你看到他每天加班处理问题，是不是觉得比前者工作努力多了呢。
毛主席曾经说过，谁做的工作越多，谁犯的错误也就越多。但是，反过来理解并不一定成立。评估开发者的标准，或许一直未曾完全公平。